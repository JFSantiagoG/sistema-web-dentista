<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>✅ Consentimiento Quirúrgico - Consultorio Dental</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/consent-quiro.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light">
  <div class="container py-4">
    <!-- Encabezado -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2>✅ Consentimiento Informado: Procedimientos Quirúrgicos</h2>
        <p class="text-muted">
          Este formulario es necesario para autorizar al dentista a realizar procedimientos quirúrgicos
          específicos y asegurar que el paciente está informado sobre los riesgos, beneficios y
          responsabilidades asociados.
        </p>
      </div>
      <button class="btn btn-outline-secondary" onclick="window.history.back()">← Volver</button>
    </div>

    <!-- Indicador de pasos -->
    <div class="step-indicator d-flex align-items-center justify-content-center mb-3">
      <div class="text-center">
        <div class="step active" id="step1-indicator">1</div>
        <div class="step-label">Datos del Doctor</div>
      </div>
      <div class="text-center mx-4 d-flex align-items-center">
        <div class="step-line" style="width:60px; height:2px; background:#dee2e6;"></div>
      </div>
      <div class="text-center">
        <div class="step" id="step2-indicator">2</div>
        <div class="step-label">Confirmación del Paciente</div>
      </div>
    </div>

    <form id="consentForm">
      <!-- Paso 1 -->
      <div id="doctor-step" class="doctor-section">
        <!-- Identificación del Paciente -->
        <div class="card section-card">
          <div class="card-header bg-danger text-white">
            <h5 class="mb-0">1. Identificación del Paciente</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Autocompletado por URL + fetch -->
              <div class="col-md-6 mb-3">
                <label class="form-label required">Nombre del Paciente</label>
                <input type="text" id="pacienteNombre" class="form-control" readonly placeholder="Cargando...">
                <input type="hidden" id="pacienteId">
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label required">Fecha</label>
                <input type="date" id="fechaRegistroInput" class="form-control" required>
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Número de paciente</label>
                <input type="text" id="numeroPacienteInput" class="form-control" readonly placeholder="Se asigna automáticamente">
              </div>
            </div>
          </div>
        </div>

        <!-- Pronóstico y Condiciones Posoperatorias -->
        <div class="card section-card">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">4. Pronóstico y Condiciones Posoperatorias</h5>
          </div>
          <div class="card-body">
            <p><strong>Estoy plenamente informado y acepto que el pronóstico para el procedimiento antes mencionado es:</strong></p>
            <textarea id="pronosticoInput" class="form-control mb-4" rows="3" placeholder="Especificar el pronóstico del procedimiento..." required></textarea>
            <p><strong>Además se me ha explicado de manera comprensible las condiciones posoperatorias normales:</strong></p>
            <textarea id="condicionesInput" class="form-control" rows="3" placeholder="Describir las condiciones posoperatorias normales..." required></textarea>
          </div>
        </div>

        <!-- Tiempo de Recuperación -->
        <div class="card section-card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">5. Tiempo de Recuperación y Cicatrices</h5>
          </div>
          <div class="card-body">
            <p>
              Se me ha informado que este tratamiento presenta un tiempo de recuperación de
              <input type="number" id="recuperacionInput" class="form-control d-inline" style="width: 100px;" min="1" max="365" placeholder="7" required>
              días aproximadamente y que en procedimientos quirúrgicos puede existir la presencia de cicatrices posoperatorias.
            </p>
          </div>
        </div>

        <!-- Acuerdo Económico -->
        <div class="card section-card">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">7. Acuerdo Económico</h5>
          </div>
          <div class="card-body">
            <label class="form-label required">Acuerdo económico relacionado con el procedimiento</label>
            <input type="text" id="acuerdoInput" class="form-control" placeholder="Especificar el acuerdo económico..." required>
          </div>
        </div>

        <!-- Botón siguiente -->
        <div class="text-center mt-4">
          <button type="button" class="btn btn-danger btn-lg btn-step" id="btnNext">
            Siguiente → Confirmación del Paciente
          </button>
        </div>
      </div>

      <!-- Paso 2 -->
      <div id="patient-step" class="patient-section" style="display:none;">
        <!-- Identificación (confirmación) -->
        <div class="card section-card">
          <div class="card-header bg-danger text-white">
            <h5 class="mb-0">1. Identificación del Paciente</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Nombre del Paciente</label>
                <input type="text" id="confirmNombrePaciente" class="form-control" readonly>
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Fecha</label>
                <input type="text" id="confirmFecha" class="form-control" readonly>
              </div>
              <div class="col-md-3 mb-3">
                <label class="form-label">Número de paciente</label>
                <input type="text" id="confirmNumeroPaciente" class="form-control" readonly>
              </div>
            </div>
          </div>
        </div>

        <!-- Historia clínica -->
        <div class="card section-card">
          <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">2. Historia Clínica y Responsabilidad del Paciente</h5>
          </div>
          <div class="card-body">
            <p>
              Expresto bajo protesta de decir la verdad que no he omitido o alterado datos al responder la historia clínica,
              específicamente en los puntos relacionados con: Alergias, automedicación, consumo de estimulantes o drogas,
              embarazo, trastornos provocados por intervenciones anteriores o reacciones adversas a medicamentos o anestesia.
            </p>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="historiaCheck" required>
              <label class="form-check-label required" for="historiaCheck">
                He respondido sinceramente a todas las preguntas de mi historia clínica.
              </label>
            </div>
          </div>
        </div>

        <!-- Anestesia -->
        <div class="card section-card">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">3. Consentimiento para Anestesia</h5>
          </div>
          <div class="card-body">
            <p>
              Doy el consentimiento para la administración de los anestésicos que se consideren necesarios. Se me ha explicado
              que el tipo de anestesia, la técnica empleada y las molestias resultantes son temporales. Comprendo que cualquier
              forma de anestesia entraña un riesgo, complicaciones, lesiones y muy raramente la muerte.
            </p>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="anestesiaCheck" required>
              <label class="form-check-label required" for="anestesiaCheck">
                Conozco y acepto los riesgos asociados a la anestesia.
              </label>
            </div>
          </div>
        </div>

        <!-- Pronóstico y Condiciones -->
        <div class="card section-card">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">4. Pronóstico y Condiciones Posoperatorias</h5>
          </div>
          <div class="card-body">
            <p><strong>Pronóstico del procedimiento:</strong></p>
            <textarea id="confirmPronostico" class="form-control mb-3" rows="2" readonly></textarea>
            <p><strong>Condiciones posoperatorias normales:</strong></p>
            <textarea id="confirmCondiciones" class="form-control" rows="2" readonly></textarea>
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" id="pronosticoCheck" required>
              <label class="form-check-label required" for="pronosticoCheck">
                He sido informado y entiendo el pronóstico y condiciones posoperatorias.
              </label>
            </div>
          </div>
        </div>

        <!-- Tiempo de Recuperación -->
        <div class="card section-card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">5. Tiempo de Recuperación y Cicatrices</h5>
          </div>
          <div class="card-body">
            <p>
              Tiempo de recuperación: <strong><span id="confirmRecuperacion"></span> días</strong> y puede existir la presencia de cicatrices.
            </p>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="recuperacionCheck" required>
              <label class="form-check-label required" for="recuperacionCheck">
                He sido informado sobre el tiempo de recuperación y posibles cicatrices.
              </label>
            </div>
          </div>
        </div>

        <!-- Responsabilidad -->
        <div class="card section-card">
          <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">6. Responsabilidad Personal del Paciente</h5>
          </div>
          <div class="card-body">
            <p>
              Me hago solidariamente responsable del cuidado de mi boca, a través de una correcta higiene, control de dieta,
              y el seguimiento de las indicaciones del profesional tratante.
            </p>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="responsabilidadCheck" required>
              <label class="form-check-label required" for="responsabilidadCheck">
                Acepto estar responsable del cuidado de mi salud bucal según las indicaciones.
              </label>
            </div>
          </div>
        </div>

        <!-- Acuerdo Económico -->
        <div class="card section-card">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">7. Acuerdo Económico</h5>
          </div>
          <div class="card-body">
            <p><strong>Acuerdo económico:</strong> <span id="confirmAcuerdo"></span></p>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="economicoCheck" required>
              <label class="form-check-label required" for="economicoCheck">
                Acepto las condiciones económicas del tratamiento.
              </label>
            </div>
          </div>
        </div>

        <!-- Firmas -->
        <div class="card section-card">
          <div class="card-header bg-danger text-white">
            <h5 class="mb-0">8. Firmas Electrónicas</h5>
          </div>
          <div class="card-body">
            <div class="row">
            <!-- Firma del Paciente -->
            <div class="col-md-6 mb-4">
              <h6 class="text-center">Firma del Paciente</h6>
              <div class="firma-wrap text-center">
                <canvas id="signature-pad-paciente" width="360" height="120"
                  style="border:2px dashed #6c757d; border-radius:8px; background:#fff; cursor:crosshair;"></canvas>
              </div>
              <div class="mt-2 d-flex justify-content-center">
                <button type="button" class="btn btn-sm btn-outline-danger" id="clearSignature-pad-paciente">
                  🧹 Limpiar
                </button>
              </div>
            </div>

            <!-- Firma del Doctor -->
            <div class="col-md-6 mb-4">
              <h6 class="text-center">Firma del Doctor</h6>
              <div class="firma-wrap text-center">
                <canvas id="signature-pad-medico" width="360" height="120"
                  style="border:2px dashed #6c757d; border-radius:8px; background:#fff; cursor:crosshair;"></canvas>
              </div>
              <div class="mt-2 d-flex justify-content-center">
                <button type="button" class="btn btn-sm btn-outline-danger" id="clearSignature-pad-medico">
                  🧹 Limpiar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Botones -->
        <div class="text-center mt-4">
          <button type="button" class="btn btn-outline-secondary btn-lg me-2" id="btnBack">← Volver</button>
          <button type="button" class="btn btn-outline-primary btn-lg me-2" id="btnBorrador">💾 Guardar Borrador</button>
          <button type="submit" class="btn btn-success btn-lg">📤 Enviar Formulario</button>
          <button type="button" class="btn btn-info btn-lg ms-2" id="btnPDF">🖨️ Descargar PDF</button>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/consent-quiro.js"></script>
</body>
</html>
